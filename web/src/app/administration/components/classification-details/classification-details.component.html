<div class="classification-details">
  <taskana-shared-spinner [isRunning]="requestInProgress" class="floating"
                          (spinnerIsRunning)="spinnerRunning($event)"></taskana-shared-spinner>
  <div id="classification-details" *ngIf="classification && !spinnerIsRunning">
    <div id="classification" class="classification">

      <!-- TITLE + ACTION BUTTONS -->
      <section class="classification-details__action-toolbar">
        <h4 class="panel-header classification-details__headline">{{classification.name}}&nbsp; [{{classification.type}}]
          <span *ngIf="isCreatingNewClassification" class="badge warning"> {{badgeMessage$ | async}}</span>
        </h4>

        <div>
        <button mat-button class="action-toolbar__button action-toolbar__save-button" matTooltip="Save changes in current classification" (click)="onSubmit()">
          Save
          <mat-icon>save</mat-icon>
        </button>

        <button mat-stroked-button class="action-toolbar__button" matTooltip="Revert changes to previous saved state" (click)="onRestore()">
          Undo Changes
          <mat-icon class="button__green-blue">restore</mat-icon>
        </button>

        <button mat-stroked-button [matMenuTriggerFor]="buttonMenu" matTooltip="More actions" class="action-toolbar__button">
          <mat-icon>more_vert</mat-icon>
        </button>

        <mat-menu #buttonMenu="matMenu">
          <button mat-menu-item class="action-toolbar__button action-toolbar__dropdown" matTooltip="Copy current values to create new classification" (click)="onCopy()">
            <mat-icon class="button__green-blue">content_copy</mat-icon>
            <span>Copy</span>
          </button>
          <button mat-menu-item class="action-toolbar__button action-toolbar__dropdown" matTooltip="Delete this classification" (click)="onRemoveClassification()">
            <mat-icon class="button__red">delete</mat-icon>
            <span>Delete</span>
          </button>
          <button mat-menu-item style="border-bottom-style: none;" class="action-toolbar__button action-toolbar__dropdown" matTooltip="Close this classification and discard all changes" (click)="onCloseClassification()">
            <mat-icon>close</mat-icon>
            <span>Close</span>
          </button>
        </mat-menu>
        </div>

      </section>

      <!-- DETAILED FIELDS -->
      <h6 class="classification-details__subheading"> General </h6>
      <hr class="classification-details__horizontal-line">
      <div class="panel-body classification__detailed-fields" style="padding: 0">
        <ng-form #ClassificationForm="ngForm">
          <div class="row" style="padding: 15px">
            <div class="col-md-6">

              <!--TODO pattern?-->
              <!-- KEY -->
              <div class="form-group required">
                <label for="classification-key" class="control-label">Key</label>
                <input type="text" required maxlength="32" #key="ngModel" [disabled]="!isCreatingNewClassification"
                       class="form-control"
                       id="classification-key" placeholder="Key" [(ngModel)]="classification.key"
                       name="classification.key" (input)="validateInputOverflow(key, 32)">
                <div *ngIf="inputOverflowMap.get(key.name)" class="error">{{lengthError}}</div>
                <taskana-shared-field-error-display [displayError]="key.invalid && key.dirty"
                                                    errorMessage="* Key is required">
                </taskana-shared-field-error-display>
              </div>

              <!-- NAME -->
              <div class="form-group required">
                <label for="classification-name" class="control-label">Name</label>
                <input type="text" required maxlength="255" #name="ngModel"
                       class="form-control"
                       id="classification-name" placeholder="Name"
                       [(ngModel)]="classification.name" name="classification.name"
                       (input)="validateInputOverflow(name, 255)">
                <div *ngIf="inputOverflowMap.get(name.name)" class="error">{{lengthError}}</div>
                <taskana-shared-field-error-display [displayError]="name.invalid && name.dirty"
                                                    errorMessage="* Name is required">
                </taskana-shared-field-error-display>
              </div>

              <!-- DOMAIN -->
              <div class="form-group detailed-fields__domain">
                <label for="classification-domain" class="control-label">Domain</label>
                <input type="text" disabled #domain class="form-control" id="classification-domain"
                       placeholder="Domain" [(ngModel)]="classification.domain"
                       name="classification.domain">
                <a *ngIf="!masterDomainSelected()" (click)="validChanged()">
                  <label>
                    <b>Valid in Domain:</b>
                    <span class="material-icons md-20 blue ">{{classification.isValidInDomain
                        ? 'check_box' :
                        'check_box_outline_blank'}}</span>
                  </label>
                </a>
              </div>

              <!-- PRIORITY AND CATEGORY -->
              <div class="row">
                <div class="form-group required col-xs-6">
                  <label for="classification-priority" class="control-label">Priority</label>
                  <taskana-shared-number-picker [(ngModel)]="classification.priority"
                                                name="classification.priority"
                                                id="classification-priority"
                                                [required]="true"></taskana-shared-number-picker>
                  <taskana-shared-field-error-display
                      [displayError]="!isFieldValid('classification.priority')"
                      [validationTrigger]="this.toggleValidationMap.get('classification.priority.name')"
                      errorMessage="* Priority is required">
                  </taskana-shared-field-error-display>
                </div>
                <div class="form-group required">
                  <mat-label class="control-label">Category</mat-label>
                  <button mat-icon-button [matMenuTriggerFor]="menu">
                    <svg-icon class="categories" [src]="(getCategoryIcon(this.classification.category) | async)?.name" [title]="(getCategoryIcon(this.classification.category) | async)?.text"></svg-icon>
                    {{this.classification.category}}
                  </button>
                  <mat-menu #menu="matMenu">
                    <button mat-menu-item *ngFor="let category of categories$ | async" (click)="selectCategory(category)">
                      <svg-icon class="categories" [src]="(getCategoryIcon(category) | async)?.name" [title]="(getCategoryIcon(category) | async)?.text"></svg-icon>
                      <span> {{category}}</span>
                    </button>
                  </mat-menu>
                </div>
              </div>
            </div>
            <div class="col-md-6">

              <!-- SERVICE LEVEL -->
              <div class="form-group">
                <label for="classification-service-level" class="control-label">Service
                  Level</label>
                <input type="text" maxlength="255" class="form-control"
                       id="classification-service-level" placeholder="Service Level"
                       [(ngModel)]="classification.serviceLevel" name="classification.serviceLevel"
                       #serviceLevel="ngModel" (input)="validateInputOverflow(serviceLevel, 255)">
                <div *ngIf="inputOverflowMap.get(serviceLevel.name)" class="error">{{lengthError}}</div>
              </div>

              <!-- APPLICATION ENTRY POINT -->
              <div class="form-group">
                <label for="classification-application-entry-point" class="control-label">
                  Application entry point</label>
                <input type="text" maxlength="255" class="form-control"
                       id="classification-application-entry-point"
                       placeholder="Application entry point"
                       [(ngModel)]="classification.applicationEntryPoint"
                       name="classification.applicationEntryPoint" #appEntryPoint="ngModel"
                       (input)="validateInputOverflow(appEntryPoint, 255)">
                <div *ngIf="inputOverflowMap.get(appEntryPoint.name)" class="error">{{lengthError}}</div>
              </div>

              <!-- DESCRIPTION -->
              <div class="form-group">
                <label for="classification-description" class="control-label">Description</label>
                <textarea class="form-control" maxlength="255" rows="5"
                          id="classification-description" placeholder="Description"
                          [(ngModel)]="classification.description"
                          name="classification.description" #description="ngModel"
                          (input)="validateInputOverflow(description, 255)"></textarea>
                <div *ngIf="inputOverflowMap.get(description.name)" class="error">{{lengthError}}</div>
              </div>
            </div>
          </div>

          <!-- CUSTOM FIELDS -->
          <h6 class="classification-details__subheading"> Custom Fields </h6>
          <hr class="classification-details__horizontal-line">

          <div class="row custom-field-row">
            <div class="custom-classification-form"
                 *ngFor="let customField of (customFields$ | async), let i = index"
                 style="width: 50%;">
              <div *ngIf="customField.visible" class="form-group custom-field-wrapper">
                <label for="classification-custom-{{i + 1}}"
                       class="control-label">{{customField.field}}</label>
                <input type="text" maxlength="255" class="form-control"
                       id="classification-custom-{{i + 1}}" placeholder="{{customField.field}}"
                       [(ngModel)]="classification[getClassificationCustom(i + 1)]"
                       name="classification.custom{{i + 1}}" #custom="ngModel"
                       (input)="validateInputOverflow(custom, 255)">
                <div *ngIf="inputOverflowMap.get(custom.name)" class="error">{{lengthError}}</div>
              </div>
            </div>
          </div>
        </ng-form>
      </div>
    </div>
  </div>
</div>
