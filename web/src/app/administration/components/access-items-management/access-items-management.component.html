<div class="access-items-management panel panel-default">

  <div class="panel-heading">
    <h4 class="panel-header">Access items management</h4>
  </div>

  <div class="panel-body">
    <div style="width: 50%; margin-left:25%;margin-right: 25%;">
      <taskana-shared-type-ahead name="accessIdSelected" [(ngModel)]="accessIdSelected"
        placeHolderMessage="Search for access id..." (selectedItem)="onSelectAccessId($event)" displayError=true
        isRequired="false">
      </taskana-shared-type-ahead>
    </div>

    <div *ngIf="!accessItemsForm" class="center-block no-detail">
      <h3 class="grey">Select an access id</h3>
      <svg-icon class="empty-icon" src="./assets/icons/users.svg"></svg-icon>
    </div>

    <div *ngIf="accessItemsForm">
      <ng-form [formGroup]="accessItemsForm">
        <table id="table-access-items" class="table table-striped table-center">
          <thead>
            <tr>
              <th style="text-align: left;padding:0.2rem  !important;">
                <taskana-shared-sort [sortingFields]="sortingFields" (performSorting)="sorting($event)"
                  menuPosition="left">
                </taskana-shared-sort>
              </th>
              <th matTooltip="Workbasket Key" style="text-align: left;padding:0.2rem  !important;">Key</th>
              <th colspan="2" style="text-align: left;">Access Id</th>
              <th>Read</th>
              <th>Open</th>
              <th>Append</th>
              <th matTooltip="Transfer">Trans</th>
              <th matTooltip="Distribute">Distr</th>
              <ng-container *ngFor=" let customField of fields_short">
                <th *ngIf="customField[1]" matTooltip="{{customField[0]}}">
                  {{customField[2]}}
                </th>
              </ng-container>
            </tr>
            <tr>
              <th colspan="2" style="position: sticky;" class="text-align">
                <mat-form-field appearance="outline">
                  <mat-label>Workbasket filter</mat-label>
                  <input matInput formControlName="workbasketKeyFilter"
                    (keyup.enter)="searchForAccessItemsWorkbaskets()" type="text">
                </mat-form-field>
              </th>
              <th colspan="2" style="position: sticky;" class="text-align">
                <mat-form-field appearance="outline">
                  <mat-label>Access id filter</mat-label>
                  <input matInput formControlName="accessIdFilter" (keyup.enter)="searchForAccessItemsWorkbaskets()"
                    type="text">
                </mat-form-field>
              </th>
              <th>
                <div style="margin-left: 20px;margin-bottom: 10px;">
                  <button mat-icon-button (click)="searchForAccessItemsWorkbaskets()" title="Search">
                    <mat-icon>search</mat-icon>
                  </button>
                </div>
              </th>
            </tr>
          </thead>
          <tbody formArrayName="accessItemsGroups">
            <tr class="table__access-item-groups"
              *ngFor="let accessItem of accessItemsGroups.controls; let index = index;"
              [formGroupName]="index.toString()">
              <td colspan="2">
                <label class="wrap">{{accessItem.value.workbasketKey}}</label>
              </td>
              <td *ngIf="(accessItemsCustomization$ | async)?.accessId.lookupField else accessIdInput" colspan="2"
                class="text-align text-width taskana-type-ahead" style="padding-top: 0;">
                <label class="wrap">{{accessItem.value.accessName}}</label>
              </td>
              <ng-template #accessIdInput>
                <td colspan="2" class="text-align text-width">
                  <div>
                    <label>
                      <input type="text" class="form-control" formControlName="accessId" placeholder="{{accessItem.invalid?
                       '* Access id is required': ''}}">
                    </label>
                  </div>
                </td>
              </ng-template>
              <td>
                <mat-checkbox id="checkbox-{{index}}-0" formControlName="permRead"></mat-checkbox>
              </td>
              <td>
                <mat-checkbox id="checkbox-{{index}}-1" formControlName="permOpen"></mat-checkbox>
              </td>
              <td>
                <mat-checkbox id="checkbox-{{index}}-2" formControlName="permAppend"></mat-checkbox>
              </td>
              <td>
                <mat-checkbox id="checkbox-{{index}}-3" formControlName="permTransfer"></mat-checkbox>
              </td>
              <td>
                <mat-checkbox id="checkbox-{{index}}-4" formControlName="permDistribute"></mat-checkbox>
              </td>
              <ng-container *ngFor="let customField of fields_short; let customIndex = index">
                <td *ngIf="customField[1]">
                  <mat-checkbox id="checkbox-{{index}}-{{customIndex + 5}}"
                    formControlName="permCustom{{customIndex + 1}}"></mat-checkbox>
                </td>
              </ng-container>
            </tr>
          </tbody>
        </table>
        <button mat-flat-button color="primary" style="margin-bottom: 80px; margin-left: 20px;" (click)="openDialog()">
          Belonging groups
        </button>
        <button mat-mini-fab color="warn" style="float: right; margin-right: 30px;" *ngIf="accessItemsForm"
          (click)="revokeAccess()" title="Revoke access" [disabled]=isGroup>
          <mat-icon>clear</mat-icon>
        </button>
      </ng-form>
    </div>
  </div>
</div>

<!--<div *ngIf="accessItemsForm">
  <ng-form [formGroup]="accessItemsForm">
    <table id="table-access-items" class="table table-striped table-center">
      <thead>
        <tr>
          <th style="text-align: left;padding:0.2rem  !important;">
            <taskana-shared-sort [sortingFields]="sortingFields" (performSorting)="sorting($event)"
              menuPosition="left">
            </taskana-shared-sort>
          </th>
          <th matTooltip="Workbasket Key" style="text-align: left;padding:0.2rem  !important;">Key</th>
          <th colspan="2" style="text-align: left;">Access Id</th>
          <th>Read</th>
          <th>Open</th>
          <th>Append</th>
          <th matTooltip="Transfer">Trans</th>
          <th matTooltip="Distribute">Distr</th>
          <ng-container *ngFor=" let customField of fields_short">
            <th *ngIf="customField[1]" matTooltip="{{customField[0]}}">
              {{customField[2]}}
            </th>
          </ng-container>
        </tr>
        <tr>
          <th colspan="2" style="position: sticky;" class="text-align">
            <mat-form-field appearance="outline">
              <mat-label>Workbasket filter</mat-label>
              <input matInput formControlName="workbasketKeyFilter"
                (keyup.enter)="searchForAccessItemsWorkbaskets()" type="text">
            </mat-form-field>
          </th>
          <th colspan="2" style="position: sticky;" class="text-align">
            <mat-form-field appearance="outline">
              <mat-label>Access id filter</mat-label>
              <input matInput formControlName="accessIdFilter" (keyup.enter)="searchForAccessItemsWorkbaskets()"
                type="text">
            </mat-form-field>
          </th>
          <th>
            <div style="margin-left: 20px;margin-bottom: 10px;">
              <button mat-icon-button (click)="searchForAccessItemsWorkbaskets()" title="Search">
                <mat-icon>search</mat-icon>
              </button>
            </div>
          </th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody formArrayName="accessItemsGroups">
        <tr class="table__access-item-groups"
          *ngFor="let accessItem of accessItemsGroups.controls; let index = index;"
          [formGroupName]="index.toString()">
          <td colspan="2">
            <label class="wrap">{{accessItem.value.workbasketKey}}</label>
          </td>
          <td *ngIf="(accessItemsCustomization$ | async)?.accessId.lookupField else accessIdInput" colspan="2"
            class="text-align text-width taskana-type-ahead" style="padding-top: 0;">
            <label class="wrap">{{accessItem.value.accessName}}</label>
          </td>
          <ng-template #accessIdInput>
            <td colspan="2" class="text-align text-width">
              <div>
                <label>
                  <input type="text" class="form-control" formControlName="accessId" placeholder="{{accessItem.invalid?
                   '* Access id is required': ''}}">
                </label>
              </div>
            </td>
          </ng-template>
          <td>
            <mat-checkbox id="checkbox-{{index}}-0" formControlName="permRead"></mat-checkbox>
          </td>
          <td>
            <mat-checkbox id="checkbox-{{index}}-1" formControlName="permOpen"></mat-checkbox>
          </td>
          <td>
            <mat-checkbox id="checkbox-{{index}}-2" formControlName="permAppend"></mat-checkbox>
          </td>
          <td>
            <mat-checkbox id="checkbox-{{index}}-3" formControlName="permTransfer"></mat-checkbox>
          </td>
          <td>
            <mat-checkbox id="checkbox-{{index}}-4" formControlName="permDistribute"></mat-checkbox>
          </td>
          <ng-container *ngFor="let customField of fields_short; let customIndex = index">
            <td *ngIf="customField[1]">
              <mat-checkbox id="checkbox-{{index}}-{{customIndex + 5}}"
                formControlName="permCustom{{customIndex + 1}}"></mat-checkbox>
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
    <button mat-flat-button color="primary" style="margin-bottom: 80px; margin-left: 20px;" (click)="openDialog()">
      Belonging groups
    </button>
    <button mat-mini-fab color="warn" style="float: right; margin-right: 30px;" *ngIf="accessItemsForm"
      (click)="revokeAccess()" title="Revoke access" [disabled]=isGroup>
      <mat-icon>clear</mat-icon>
    </button>
  </ng-form>
</div>
</div>
</div>-->